<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Notebook collections"><link href=https://abhaydgarg.github.io/Notebook/index.html/nodejs/wiring-modules/ rel=canonical><meta name=author content="Abhay Garg"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.2"><title>Wiring modules - Notebook</title><link rel=stylesheet href=../../assets/stylesheets/application.30686662.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#2196f3><script src=../../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700|Ubuntu+Mono&display=fallback"><style>body,input{font-family:"Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr data-md-color-primary=blue data-md-color-accent=blue> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#wiring-modules tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://abhaydgarg.github.io/Notebook/index.html title=Notebook class="md-header-nav__button md-logo"> <i class=md-icon></i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Notebook </span> <span class=md-header-nav__topic> Wiring modules </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/abhaydgarg/Notebook/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://abhaydgarg.github.io/Notebook/index.html title=Notebook class="md-nav__button md-logo"> <i class=md-icon></i> </a> Notebook </label> <div class=md-nav__source> <a href=https://github.com/abhaydgarg/Notebook/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../computer-science/ title=CS class=md-nav__link> CS </a> </li> <li class=md-nav__item> <a href=../../parser/ title=Parser class=md-nav__link> Parser </a> </li> <li class=md-nav__item> <a href=../../data-structure-and-algorithms/ title="Data Structure and Algorithms" class=md-nav__link> Data Structure and Algorithms </a> </li> <li class=md-nav__item> <a href=../../oops/ title=OOPS class=md-nav__link> OOPS </a> </li> <li class=md-nav__item> <a href=../../design-patterns/ title="Design Patterns" class=md-nav__link> Design Patterns </a> </li> <li class=md-nav__item> <a href=../../regex/ title=Regex class=md-nav__link> Regex </a> </li> <li class=md-nav__item> <a href=../../git/ title=GIT class=md-nav__link> GIT </a> </li> <li class=md-nav__item> <a href=../../css/ title=CSS class=md-nav__link> CSS </a> </li> <li class=md-nav__item> <a href=../../rest-api/ title="REST API" class=md-nav__link> REST API </a> </li> <li class=md-nav__item> <a href=../../eslint/ title=ESLint class=md-nav__link> ESLint </a> </li> <li class=md-nav__item> <a href=../../javascript/ title=Javascript class=md-nav__link> Javascript </a> </li> <li class=md-nav__item> <a href=../ title=Node.js class=md-nav__link> Node.js </a> </li> <li class=md-nav__item> <a href=../../react/ title=React class=md-nav__link> React </a> </li> <li class=md-nav__item> <a href=../../react-native/ title="React Native" class=md-nav__link> React Native </a> </li> <li class=md-nav__item> <a href=../../redux-saga/ title="Redux Saga" class=md-nav__link> Redux Saga </a> </li> <li class=md-nav__item> <a href=../../rxjs/ title=RxJS class=md-nav__link> RxJS </a> </li> <li class=md-nav__item> <a href=../../mysql/ title=MySQL class=md-nav__link> MySQL </a> </li> <li class=md-nav__item> <a href=../../mongodb/ title=MongoDB class=md-nav__link> MongoDB </a> </li> <li class=md-nav__item> <a href=../../web-security/ title="Web Security" class=md-nav__link> Web Security </a> </li> <li class=md-nav__item> <a href=../../rust/ title=Rust class=md-nav__link> Rust </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#a-note-about-modules-and-dependencies class=md-nav__link> A note about modules and dependencies </a> </li> <li class=md-nav__item> <a href=#module-basic-unit class=md-nav__link> Module [basic unit] </a> </li> <li class=md-nav__item> <a href=#what-is-stateful-module class=md-nav__link> What is stateful module </a> </li> <li class=md-nav__item> <a href=#hardcoded-dependency class=md-nav__link> Hardcoded dependency </a> </li> <li class=md-nav__item> <a href=#dependency-injection class=md-nav__link> Dependency injection </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#types-of-dependency-injection class=md-nav__link> Types of dependency injection </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#service-locator class=md-nav__link> Service locator </a> </li> <li class=md-nav__item> <a href=#dependency-injection-container class=md-nav__link> Dependency injection container </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#some-considerations class=md-nav__link> Some considerations </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#minification-solution class=md-nav__link> Minification solution </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/abhaydgarg/Notebook/tree/master/src/nodejs/wiring-modules.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1 id=wiring-modules>Wiring modules<a class=headerlink href=#wiring-modules title="Permanent link">&para;</a></h1> <h2 id=a-note-about-modules-and-dependencies>A note about modules and dependencies<a class=headerlink href=#a-note-about-modules-and-dependencies title="Permanent link">&para;</a></h2> <p>Every modern application is the result of the aggregation of several components and, as the application grows, the way we connect these components becomes a win or lose factor. It's not only a problem related to technical aspects such as extensibility, but it's also a concern with the way we perceive the system. A tangled dependency graph is a liability and it adds to the technical debt of the project; in such a situation, any change in the code aimed to either modify or extend its functionality can result in a tremendous effort.</p> <p>In the worst case, the components are so tightly connected together that it becomes impossible to add or change anything without refactoring or even completely rewriting entire parts of the application. This, of course, does not mean that we have to over-engineer our design starting from the very first module, but surely finding a good balance from the very beginning can make a huge difference.</p> <p>Node.js provides a great tool for organizing and wiring the components of an application together: it's the CommonJS module system. However, the module system alone is not a guarantee for success; if on one side, it adds a convenient level of indirection between the client module and the dependency, then on the other, it might introduce a tighter coupling if not used properly.</p> <h2 id=module-basic-unit>Module <em>[basic unit]</em><a class=headerlink href=#module-basic-unit title="Permanent link">&para;</a></h2> <p>Module is the fundamental unit to organize and structure our code; it's unreasonable to build a large application without relying on the module system at all. If used properly to group the various elements of an application, it can bring a lot of advantages.</p> <ul> <li>A module is more readable and understandable because (ideally) it's more focused on doing one thing only.</li> <li>Being represented as a separate file, a module is easier to identify.</li> <li>A module can be more easily reused across different applications.</li> <li>A module represents the perfect level information hiding and gives an effective mechanism to expose only the public interface of a component (using <code>module.exports</code>).</li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Simply spreading the functionality of an application or a library across different modules is not enough for a successful design; it has to be done right.</p> </div> <h2 id=what-is-stateful-module>What is stateful module<a class=headerlink href=#what-is-stateful-module title="Permanent link">&para;</a></h2> <p>Modules such as <code>db</code> connector, an <code>HTTP</code> server instance, the instance of a <code>service</code>, or in general any object which is not <code>stateless</code> are stateful module.</p> <h2 id=hardcoded-dependency>Hardcoded dependency<a class=headerlink href=#hardcoded-dependency title="Permanent link">&para;</a></h2> <p>In Node.js, this is obtained when a client module explicitly loads another module using <code>require()</code>.</p> <p><img alt="Hardcoded dependency" src=../assets/hardcode-dependency.png></p> <p>It describes the structure of a simple authentication system. <code>AuthController</code> accepts the input from the client, extracts the login information from the request, and performs some preliminary validation. It then relies on <code>AuthService</code> to check whether the provided credentials match with the information stored in the database; this is done by executing some specific queries using a <code>DB</code> handle as a means to communicate with the database.</p> <p>The way these three components are connected together will determine their level of reusability, testability, and maintainability. The most natural way to wire these components together is requiring the <code>DB</code> module from <code>AuthService</code> and then requiring <code>AuthService</code> from <code>AuthController</code>. This is the hardcoded dependency that we are talking about.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>// db module</span>
<span class=kd>var</span> <span class=nx>level</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;level&#39;</span><span class=p>);</span>
<span class=kd>var</span> <span class=nx>sublevel</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;level-sublevel&#39;</span><span class=p>);</span>

<span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>sublevel</span><span class=p>(</span><span class=nx>level</span><span class=p>(</span><span class=s1>&#39;my-example-db&#39;</span><span class=p>,</span> <span class=p>{</span><span class=nx>valueEncoding</span><span class=o>:</span> <span class=s1>&#39;json&#39;</span><span class=p>});</span>
</pre></div> </td></tr></table> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>// authService module</span>
<span class=kd>var</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./db&#39;</span><span class=p>);</span>
<span class=kd>var</span> <span class=nx>users</span> <span class=o>=</span> <span class=nx>db</span><span class=p>.</span><span class=nx>sublevel</span><span class=p>(</span><span class=s1>&#39;users&#39;</span><span class=p>);</span>

<span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=p>.</span><span class=nx>login</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>username</span><span class=p>,</span> <span class=nx>password</span><span class=p>,</span> <span class=nx>callback</span><span class=p>)</span> <span class=p>{</span>
   <span class=nx>users</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>username</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// [...]</span>
  <span class=p>});</span>
<span class=p>};</span>
</pre></div> </td></tr></table> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5
6
7
8</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>// authController module</span>
<span class=kd>var</span> <span class=nx>authService</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./authService&#39;</span><span class=p>);</span>

<span class=nx>exports</span><span class=p>.</span><span class=nx>login</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
  <span class=nx>authService</span><span class=p>.</span><span class=nx>login</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>username</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>password</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>result</span><span class=p>)</span> <span class=p>{</span>
     <span class=c1>// [...]</span>
  <span class=p>});</span>
<span class=p>};</span>
</pre></div> </td></tr></table> <p>Hardcoding the dependency on a stateful instance limits the possibility of wiring the module against other instances, which makes it less reusable and harder to unit test. For example, reusing <code>authService</code> in combination with another <code>database</code> instance would be close to impossible, as its dependency is hardcoded with one particular instance. Similarly, testing <code>authService</code> in isolation can be a difficult task, because we cannot easily mock the <code>database</code> used by the module.</p> <h2 id=dependency-injection>Dependency injection<a class=headerlink href=#dependency-injection title="Permanent link">&para;</a></h2> <blockquote> <p>The main idea behind the dependency injection pattern is the dependencies of a component being provided as input (not by <code>require()</code>) by an external entity.</p> </blockquote> <p>Such an entity can be a global container. The main advantage of this approach is an improved decoupling, especially for modules depending on stateful instances. Using DI, each dependency, instead of being hardcoded into the module, is received from the outside. This means that the module can be configured to use any dependency and therefore can be reused in different contexts.</p> <p>Let's refactor the authentication system that we built in the previous section to use DI.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5
6
7</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>// db module</span>
<span class=kd>var</span> <span class=nx>level</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;level&#39;</span><span class=p>);</span>
<span class=kd>var</span> <span class=nx>sublevel</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;level-sublevel&#39;</span><span class=p>);</span>

<span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>dbName</span><span class=p>)</span> <span class=p>{</span>
 <span class=k>return</span> <span class=nx>sublevel</span><span class=p>(</span><span class=nx>level</span><span class=p>(</span><span class=nx>dbName</span><span class=p>,</span> <span class=p>{</span><span class=nx>valueEncoding</span><span class=o>:</span> <span class=s1>&#39;json&#39;</span><span class=p>})</span>
<span class=p>);</span>
</pre></div> </td></tr></table> <p>The first step in our refactoring process is to transform the <code>db</code> module into a factory. The result is that we can now use it to create as many database instances as we want; this means that the entire module is now reusable and stateless.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>// authService module</span>
<span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>db</span><span class=p>)</span> <span class=p>{</span>
  <span class=kd>var</span> <span class=nx>users</span> <span class=o>=</span> <span class=nx>db</span><span class=p>.</span><span class=nx>sublevel</span><span class=p>(</span><span class=s1>&#39;users&#39;</span><span class=p>);</span>
  <span class=kd>var</span> <span class=nx>authService</span> <span class=o>=</span> <span class=p>{};</span>

  <span class=nx>authService</span><span class=p>.</span><span class=nx>login</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>username</span><span class=p>,</span> <span class=nx>password</span><span class=p>,</span> <span class=nx>callback</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>//...same as in the previous version</span>
  <span class=p>};</span>

  <span class=k>return</span> <span class=nx>authService</span><span class=p>;</span>
<span class=p>};</span>
</pre></div> </td></tr></table> <p>Also, the <code>authService</code> module is now stateless; it doesn't export any particular instance anymore, just a simple factory. The most important detail though is that we made the <code>db</code> dependency injectable as an argument of the factory function, removing what previously was a hardcoded dependency. This simple change enables us to create a new <code>authService</code> module by wiring it to any database instance.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5
6
7
8</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>// authController module</span>
<span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>authService</span><span class=p>)</span> <span class=p>{</span>
  <span class=kd>var</span> <span class=nx>authController</span> <span class=o>=</span> <span class=p>{};</span>
  <span class=nx>authController</span><span class=p>.</span><span class=nx>login</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>//...same as in the previous version</span>
  <span class=p>};</span>
  <span class=k>return</span> <span class=nx>authController</span><span class=p>;</span>
<span class=p>};</span>
</pre></div> </td></tr></table> <p>The <code>authController</code> module does not have any hardcoded dependency at all, not even stateless! The only dependency, the <code>authService</code> module, is provided as input to the factory at the moment of its invocation.</p> <p>Okay, now it's time to see where all these modules are actually created and wired together; the answer lies in the <code>app.js</code> file or <code>router.js</code> file.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>//[1] - require modules</span>
<span class=kd>var</span> <span class=nx>dbFactory</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./lib/db&#39;</span><span class=p>);</span>
<span class=kd>var</span> <span class=nx>authServiceFactory</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./lib/authService&#39;</span><span class=p>);</span>
<span class=kd>var</span> <span class=nx>authControllerFactory</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./lib/authController&#39;</span><span class=p>);</span>

<span class=c1>//[2] - create instances</span>
<span class=c1>// IMPORTANT: Order matters.</span>
<span class=c1>// db must be aailable before authService</span>
<span class=c1>// instance is created.</span>
<span class=kd>var</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>dbFactory</span><span class=p>(</span><span class=s1>&#39;example-db&#39;</span><span class=p>);</span>
<span class=kd>var</span> <span class=nx>authService</span> <span class=o>=</span> <span class=nx>authServiceFactory</span><span class=p>(</span><span class=nx>db</span><span class=p>);</span>
<span class=kd>var</span> <span class=nx>authController</span> <span class=o>=</span> <span class=nx>authControllerFactory</span><span class=p>(</span><span class=nx>authService</span><span class=p>);</span>

<span class=c1>//[3] - register route</span>
<span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/login&#39;</span><span class=p>,</span> <span class=nx>authController</span><span class=p>.</span><span class=nx>login</span><span class=p>);</span>
</pre></div> </td></tr></table> <h3 id=types-of-dependency-injection>Types of dependency injection<a class=headerlink href=#types-of-dependency-injection title="Permanent link">&para;</a></h3> <ul> <li><strong>Constructor injection:</strong> In this type of DI, the dependencies are passed to a constructor.</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kd>var</span> <span class=nx>authController</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AuthController</span><span class=p>(</span><span class=nx>dependencyA</span><span class=p>,</span> <span class=nx>dependencyB</span><span class=p>);</span>
</pre></div> </td></tr></table> <ul> <li><strong>Property injection:</strong> In this type of DI, the dependencies are attached to an object after its creation.</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kd>var</span> <span class=nx>authController</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>AuthController</span><span class=p>();</span>
<span class=nx>authController</span><span class=p>.</span><span class=nx>dependencyA</span> <span class=o>=</span> <span class=nx>anInstanceOfDependencyA</span><span class=p>;</span>
</pre></div> </td></tr></table> <p>Using dependency injection we were able to decouple our modules from a particular dependency instance. The result is that we can now reuse each module with minimal effort and without any change in their code. Testing a module that uses the dependency injection pattern is also greatly simplified; we can easily provide mocked dependencies and test our modules in isolation from the state of the rest of the system.</p> <p>All these advantages in terms of decoupling and reusability, though, come with a price to pay. If we look at the way we instantiated all the dependencies in the <code>app</code> file, we can see that we had to follow a specific order; we practically had to manually build the dependency graph of the entire application. This can become unmanageable when the number of modules to wire becomes high.</p> <p>A viable solution to this problem is to split the dependency ownership between multiple components, instead of having it centralized all in one place. As each component would be responsible only for its particular dependency subgraph.</p> <h2 id=service-locator>Service locator<a class=headerlink href=#service-locator title="Permanent link">&para;</a></h2> <p><img alt="Service locator" src=../assets/service-locator.png></p> <p>Another pattern with a very similar intent is Service Locator. Its core principle is to have a <strong>central registry</strong> in order to manage the components of the system and to act as a mediator whenever a module needs to load a dependency. The idea is to ask the service locator for the dependency.</p> <p>Let's convert the authentication system to use an injected service locator.</p> <p>To do this, the first step is to implement the service locator itself; we will use a new module.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>// serviceLocator.js</span>
<span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
 <span class=kd>var</span> <span class=nx>dependencies</span> <span class=o>=</span> <span class=p>{};</span>
 <span class=kd>var</span> <span class=nx>factories</span> <span class=o>=</span> <span class=p>{};</span>
 <span class=kd>var</span> <span class=nx>serviceLocator</span> <span class=o>=</span> <span class=p>{};</span>

 <span class=nx>serviceLocator</span><span class=p>.</span><span class=nx>factory</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>factory</span><span class=p>)</span> <span class=p>{</span>
  <span class=nx>factories</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>factory</span><span class=p>;</span>
 <span class=p>};</span>

 <span class=nx>serviceLocator</span><span class=p>.</span><span class=nx>register</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>instance</span><span class=p>)</span> <span class=p>{</span>
  <span class=nx>dependencies</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>instance</span><span class=p>;</span>
 <span class=p>};</span>

 <span class=nx>serviceLocator</span><span class=p>.</span><span class=nx>get</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>dependencies</span><span class=p>[</span><span class=nx>name</span><span class=p>])</span> <span class=p>{</span>
    <span class=kd>var</span> <span class=nx>factory</span> <span class=o>=</span> <span class=nx>factories</span><span class=p>[</span><span class=nx>name</span><span class=p>];</span>
    <span class=nx>dependencies</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>factory</span> <span class=o>&amp;&amp;</span> <span class=nx>factory</span><span class=p>(</span><span class=nx>serviceLocator</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>dependencies</span><span class=p>[</span><span class=nx>name</span><span class=p>])</span> <span class=p>{</span>
    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Cannot find module: &#39;</span> <span class=o>+</span> <span class=nx>name</span><span class=p>);</span>
    <span class=p>}</span>
  <span class=p>}</span>
  <span class=k>return</span> <span class=nx>dependencies</span><span class=p>[</span><span class=nx>name</span><span class=p>];</span>
<span class=p>};</span>

<span class=k>return</span> <span class=nx>serviceLocator</span><span class=p>;</span>
<span class=p>};</span>
</pre></div> </td></tr></table> <ul> <li>factory() is used to associate a component name against a factory.</li> <li>register() is used to associate a component name directly with an instance.</li> <li>get() retrieves a component by its name. If an instance is already available, it simply returns it; otherwise, it tries to invoke the registered factory to obtain a new instance. It is very important to observe that the module factories are invoked by injecting the current instance of the service locator (serviceLocator). This is the core mechanism of the pattern that allows the dependency graph for our system to be built automatically and on-demand.</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5
6
7
8</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>// db module</span>
<span class=kd>var</span> <span class=nx>level</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;level&#39;</span><span class=p>);</span>
<span class=kd>var</span> <span class=nx>sublevel</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;level-sublevel&#39;</span><span class=p>);</span>

<span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>serviceLocator</span><span class=p>)</span> <span class=p>{</span>
  <span class=kd>var</span> <span class=nx>dbName</span> <span class=o>=</span> <span class=nx>serviceLocator</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;dbName&#39;</span><span class=p>);</span>
  <span class=k>return</span> <span class=nx>sublevel</span><span class=p>(</span><span class=nx>level</span><span class=p>(</span><span class=nx>dbName</span><span class=p>,</span> <span class=p>{</span><span class=nx>valueEncoding</span><span class=o>:</span> <span class=s1>&#39;json&#39;</span><span class=p>})</span>
<span class=p>);</span>
</pre></div> </td></tr></table> <p>The <code>db</code> module uses the service locator received in input to retrieve the name of the database to instantiate. This is an interesting point to highlight; a service locator can be used not only to return component instances but also to provide configuration parameters that define the behavior of the entire dependency graph that we want to create.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>// authService module</span>
<span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>serviceLocator</span><span class=p>)</span> <span class=p>{</span>
  <span class=kd>var</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>serviceLocator</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;db&#39;</span><span class=p>);</span>
  <span class=kd>var</span> <span class=nx>authService</span> <span class=o>=</span> <span class=p>{};</span>

  <span class=nx>authService</span><span class=p>.</span><span class=nx>login</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>username</span><span class=p>,</span> <span class=nx>password</span><span class=p>,</span> <span class=nx>callback</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>//...same as in the previous version</span>
  <span class=p>};</span>

  <span class=k>return</span> <span class=nx>authService</span><span class=p>;</span>
<span class=p>};</span>
</pre></div> </td></tr></table> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>// authController module</span>
<span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>serviceLocator</span><span class=p>)</span> <span class=p>{</span>
  <span class=kd>var</span> <span class=nx>authService</span> <span class=o>=</span> <span class=nx>serviceLocator</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;authService&#39;</span><span class=p>);</span>
  <span class=kd>var</span> <span class=nx>authController</span> <span class=o>=</span> <span class=p>{};</span>
  <span class=nx>authController</span><span class=p>.</span><span class=nx>login</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>//...same as in the previous version</span>
  <span class=p>};</span>
  <span class=k>return</span> <span class=nx>authController</span><span class=p>;</span>
<span class=p>};</span>
</pre></div> </td></tr></table> <p>Now we are ready to see how the service locator is instantiated and configured. This happens of course, in the <code>app.js</code> file:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>// [1]</span>
<span class=kd>var</span> <span class=nx>svcLoc</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./lib/serviceLocator&#39;</span><span class=p>)();</span>

<span class=c1>// [2]</span>
<span class=c1>// Advantage: Order is not important.</span>
<span class=nx>svcLoc</span><span class=p>.</span><span class=nx>register</span><span class=p>(</span><span class=s1>&#39;dbName&#39;</span><span class=p>,</span> <span class=s1>&#39;example-db&#39;</span><span class=p>);</span>
<span class=nx>svcLoc</span><span class=p>.</span><span class=nx>factory</span><span class=p>(</span><span class=s1>&#39;db&#39;</span><span class=p>,</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./lib/db&#39;</span><span class=p>));</span>
<span class=nx>svcLoc</span><span class=p>.</span><span class=nx>factory</span><span class=p>(</span><span class=s1>&#39;authService&#39;</span><span class=p>,</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./lib/authService&#39;</span><span class=p>));</span>
<span class=nx>svcLoc</span><span class=p>.</span><span class=nx>factory</span><span class=p>(</span><span class=s1>&#39;authController&#39;</span><span class=p>,</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./lib/authController&#39;</span><span class=p>));</span>

<span class=c1>//[3]</span>
<span class=kd>var</span> <span class=nx>authController</span> <span class=o>=</span> <span class=nx>svcLoc</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;authController&#39;</span><span class=p>);</span>

<span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/login&#39;</span><span class=p>,</span> <span class=nx>authController</span><span class=p>.</span><span class=nx>login</span><span class=p>);</span>
</pre></div> </td></tr></table> <p>It's interesting to see the <strong>lazy</strong> nature of the service locator; each instance is created only when needed. But there is another important advantage; we can see, in fact, that every dependency is automatically wired without the need to manually do it in advance. The advantage is that we don't have to know in advance what the right order for instantiating and wiring the modules is, it all happens automatically and on-demand. This is much more convenient compared to the simple dependency injection pattern.</p> <p>A component relying on a service locator is less reusable because it requires that a service locator is available in the system.</p> <h2 id=dependency-injection-container>Dependency injection container<a class=headerlink href=#dependency-injection-container title="Permanent link">&para;</a></h2> <p>The step to transform a service locator into a Dependency Injection container is not big, but it makes a huge difference in terms of decoupling.</p> <div class="admonition note"> <p class=admonition-title>Difference</p> <p>With a service locator, each component loads its dependencies explicitly from the service locator itself, when using a DI container instead, the component has no knowledge of the container.</p> </div> <p>With this pattern, in fact, each module doesn't have to depend on the service locator anymore, but it can simply express its need in terms of dependencies and the DI container will do the rest seamlessly. The big leap forward of this mechanism is that every module can be reused even without the container.</p> <p>A DI container is essentially a service locator with the addition of one feature: it identifies the dependency requirements of a module before instantiating it. For this to be possible, a module has to declare its dependencies in some way, and as we will see, we have multiple options for doing this.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>// diContainer.js</span>

<span class=c1>// Use to extract the names of the</span>
<span class=c1>// arguments of a function.</span>
<span class=kd>var</span> <span class=nx>argsList</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;args-list&#39;</span><span class=p>);</span>

<span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
 <span class=kd>var</span> <span class=nx>dependencies</span> <span class=o>=</span> <span class=p>{};</span>
 <span class=kd>var</span> <span class=nx>factories</span> <span class=o>=</span> <span class=p>{};</span>
 <span class=kd>var</span> <span class=nx>diContainer</span> <span class=o>=</span> <span class=p>{};</span>

 <span class=nx>diContainer</span><span class=p>.</span><span class=nx>factory</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>factory</span><span class=p>)</span> <span class=p>{</span>
  <span class=nx>factories</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>factory</span><span class=p>;</span>
 <span class=p>};</span>

 <span class=nx>diContainer</span><span class=p>.</span><span class=nx>register</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>dep</span><span class=p>)</span> <span class=p>{</span>
  <span class=nx>dependencies</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>dep</span><span class=p>;</span>
 <span class=p>};</span>

 <span class=nx>diContainer</span><span class=p>.</span><span class=nx>get</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>dependencies</span><span class=p>[</span><span class=nx>name</span><span class=p>])</span> <span class=p>{</span>
   <span class=kd>var</span> <span class=nx>factory</span> <span class=o>=</span> <span class=nx>factories</span><span class=p>[</span><span class=nx>name</span><span class=p>];</span>
   <span class=nx>dependencies</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>factory</span> <span class=o>&amp;&amp;</span> <span class=nx>diContainer</span><span class=p>.</span><span class=nx>inject</span><span class=p>(</span><span class=nx>factory</span><span class=p>);</span>
   <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>dependencies</span><span class=p>[</span><span class=nx>name</span><span class=p>])</span> <span class=p>{</span>
    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;Cannot find module: &#39;</span> <span class=o>+</span> <span class=nx>name</span><span class=p>);</span>
   <span class=p>}</span>
  <span class=p>}</span>
  <span class=k>return</span> <span class=nx>dependencies</span><span class=p>[</span><span class=nx>name</span><span class=p>];</span>
 <span class=p>};</span>

 <span class=c1>// This time, instead of directly invoking the module</span>
 <span class=c1>// factory, we rely on another method of the diContainer</span>
 <span class=c1>// module called inject(), which will resolve the</span>
 <span class=c1>// dependencies of a module, and use them to invoke</span>
 <span class=c1>// the factory.</span>
 <span class=nx>diContainer</span><span class=p>.</span><span class=nx>inject</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>factory</span><span class=p>)</span> <span class=p>{</span>
  <span class=kd>var</span> <span class=nx>args</span> <span class=o>=</span> <span class=nx>argsList</span><span class=p>(</span><span class=nx>factory</span><span class=p>)</span>
   <span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>dependency</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nx>diContainer</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>dependency</span><span class=p>);</span>
   <span class=p>});</span>
  <span class=k>return</span> <span class=nx>factory</span><span class=p>.</span><span class=nx>apply</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=nx>args</span><span class=p>);</span>
 <span class=p>};</span>

<span class=p>};</span>
</pre></div> </td></tr></table> <p>That's really it for our <code>diContainer</code>. As we saw it's not that much different from a service locator, but the simple step of instantiating a module by injecting its dependencies makes a dramatic difference (as compared to injecting the entire service locator).</p> <p>To complete the refactoring of the authentication system, we also need to tweak the 'app.js' file:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kd>var</span> <span class=nx>diContainer</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./lib/diContainer&#39;</span><span class=p>)();</span>

<span class=nx>diContainer</span><span class=p>.</span><span class=nx>register</span><span class=p>(</span><span class=s1>&#39;dbName&#39;</span><span class=p>,</span> <span class=s1>&#39;example-db&#39;</span><span class=p>);</span>
<span class=nx>diContainer</span><span class=p>.</span><span class=nx>factory</span><span class=p>(</span><span class=s1>&#39;db&#39;</span><span class=p>,</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./lib/db&#39;</span><span class=p>));</span>
<span class=nx>diContainer</span><span class=p>.</span><span class=nx>factory</span><span class=p>(</span><span class=s1>&#39;authService&#39;</span><span class=p>,</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./lib/authService&#39;</span><span class=p>));</span>
<span class=nx>diContainer</span><span class=p>.</span><span class=nx>factory</span><span class=p>(</span><span class=s1>&#39;authController&#39;</span><span class=p>,</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./lib/ authController&#39;</span><span class=p>));</span>

<span class=kd>var</span> <span class=nx>authController</span> <span class=o>=</span> <span class=nx>diContainer</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;authController&#39;</span><span class=p>);</span>

<span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/login&#39;</span><span class=p>,</span> <span class=nx>authController</span><span class=p>.</span><span class=nx>login</span><span class=p>);</span>
</pre></div> </td></tr></table> <h3 id=some-considerations>Some considerations<a class=headerlink href=#some-considerations title="Permanent link">&para;</a></h3> <ul> <li><strong>Consideration #1:</strong> You might notice, that this approach relies heavily on the convention that the names of arguments in modules' factory functions should be exactly the same as the names of dependencies and factories we use configuring our Dependency Injection Container. Otherwise, it just won't work.</li> <li><strong>Consideration #2:</strong> Since we rely on names, it may not work out if the minification is used. It's not that relevant for server-side, but please note that a lot of Node modules are used both on back-end and front-end. So if you see your module is going to be used on front-end, consider other techniques (see the consideration #3).</li> </ul> <h4 id=minification-solution>Minification solution<a class=headerlink href=#minification-solution title="Permanent link">&para;</a></h4> <p><strong>[1]</strong> attaching a special property to the factory function:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{};</span>
<span class=nx>module</span><span class=p>.</span><span class=nx>exports</span><span class=p>.</span><span class=nx>_inject</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;db&#39;</span><span class=p>,</span> <span class=s1>&#39;another/dependency&#39;</span><span class=p>];</span>
</pre></div> </td></tr></table> <p><strong>[2]</strong> specifying a module as an array of dependency names followed by the factory function:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;db&#39;</span><span class=p>,</span> <span class=s1>&#39;another/dependency&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{}];</span>
</pre></div> </td></tr></table> <p><strong>[3]</strong> using a comment annotation that is appended to each argument of a function (works poorly with minification):</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>a</span> <span class=cm>/*db*/</span><span class=p>,</span> <span class=nx>b</span> <span class=cm>/*another/dependency*/</span><span class=p>);</span>
</pre></div> </td></tr></table> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Abhay Garg </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.c648116f.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>