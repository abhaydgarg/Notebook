<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Notebook collections"><link href=https://abhaydgarg.github.io/Notebook/index.html/rust/ownership/ rel=canonical><meta name=author content="Abhay Garg"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.2"><title>Ownership - Notebook</title><link rel=stylesheet href=../../assets/stylesheets/application.30686662.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#2196f3><script src=../../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700|Ubuntu+Mono&display=fallback"><style>body,input{font-family:"Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr data-md-color-primary=blue data-md-color-accent=blue> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#ownership tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://abhaydgarg.github.io/Notebook/index.html title=Notebook class="md-header-nav__button md-logo"> <i class=md-icon></i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Notebook </span> <span class=md-header-nav__topic> Ownership </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/abhaydgarg/Notebook/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://abhaydgarg.github.io/Notebook/index.html title=Notebook class="md-nav__button md-logo"> <i class=md-icon></i> </a> Notebook </label> <div class=md-nav__source> <a href=https://github.com/abhaydgarg/Notebook/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../computer-science/ title=CS class=md-nav__link> CS </a> </li> <li class=md-nav__item> <a href=../../parser/ title=Parser class=md-nav__link> Parser </a> </li> <li class=md-nav__item> <a href=../../data-structure-and-algorithms/ title="Data Structure and Algorithms" class=md-nav__link> Data Structure and Algorithms </a> </li> <li class=md-nav__item> <a href=../../oops/ title=OOPS class=md-nav__link> OOPS </a> </li> <li class=md-nav__item> <a href=../../design-patterns/ title="Design Patterns" class=md-nav__link> Design Patterns </a> </li> <li class=md-nav__item> <a href=../../regex/ title=Regex class=md-nav__link> Regex </a> </li> <li class=md-nav__item> <a href=../../git/ title=GIT class=md-nav__link> GIT </a> </li> <li class=md-nav__item> <a href=../../css/ title=CSS class=md-nav__link> CSS </a> </li> <li class=md-nav__item> <a href=../../rest-api/ title="REST API" class=md-nav__link> REST API </a> </li> <li class=md-nav__item> <a href=../../eslint/ title=ESLint class=md-nav__link> ESLint </a> </li> <li class=md-nav__item> <a href=../../javascript/ title=Javascript class=md-nav__link> Javascript </a> </li> <li class=md-nav__item> <a href=../../nodejs/ title=Node.js class=md-nav__link> Node.js </a> </li> <li class=md-nav__item> <a href=../../react/ title=React class=md-nav__link> React </a> </li> <li class=md-nav__item> <a href=../../react-native/ title="React Native" class=md-nav__link> React Native </a> </li> <li class=md-nav__item> <a href=../../redux-saga/ title="Redux Saga" class=md-nav__link> Redux Saga </a> </li> <li class=md-nav__item> <a href=../../rxjs/ title=RxJS class=md-nav__link> RxJS </a> </li> <li class=md-nav__item> <a href=../../mysql/ title=MySQL class=md-nav__link> MySQL </a> </li> <li class=md-nav__item> <a href=../../mongodb/ title=MongoDB class=md-nav__link> MongoDB </a> </li> <li class=md-nav__item> <a href=../../web-security/ title="Web Security" class=md-nav__link> Web Security </a> </li> <li class=md-nav__item> <a href=../ title=Rust class=md-nav__link> Rust </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#rules class=md-nav__link> Rules </a> </li> <li class=md-nav__item> <a href=#copy-type class=md-nav__link> Copy type </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#points class=md-nav__link> Points </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#move-type class=md-nav__link> Move type </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#points_1 class=md-nav__link> Points </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#give-and-take-ownership class=md-nav__link> Give and take ownership </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/abhaydgarg/Notebook/tree/master/src/rust/ownership.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1 id=ownership>Ownership<a class=headerlink href=#ownership title="Permanent link">&para;</a></h1> <h2 id=rules>Rules<a class=headerlink href=#rules title="Permanent link">&para;</a></h2> <ul> <li>Each value in Rust has a variable that’s called its owner.</li> <li>There can only be one owner at a time.</li> <li>When the owner goes out of scope, the value will be dropped. This is how memory is freed.</li> </ul> <p>There are two kinds of type when talking about ownership, which are copy and move.</p> <p>The functionality of a type is handled by the traits which have been implemented to it. By default,variable bindings have ‘move semantics.’ However, if a type implements <code>core::marker::Copy</code> trait, it has a ‘copy semantics’.</p> <h2 id=copy-type>Copy type<a class=headerlink href=#copy-type title="Permanent link">&para;</a></h2> <blockquote> <p>Memory allocation <strong>[stack]</strong></p> </blockquote> <p>The types which are fixed in size are stored in stack. All data stored on the stack must have a known, fixed size.</p> <p>Here are some of the types that are <code>Copy</code>:</p> <ul> <li>All the integer types, such as <code>u32</code>.</li> <li>The Boolean type, <code>bool</code>, with values <code>true</code> and <code>false</code>.</li> <li>All the floating point types, such as <code>f64</code>.</li> <li>The character type, <code>char</code>.</li> <li>Tuples, if they only contain types that are also <code>Copy</code>. For example, <code>(i32, i32)</code> is <code>Copy</code>, but <code>(i32, String)</code> is not.</li> </ul> <h3 id=points>Points<a class=headerlink href=#points title="Permanent link">&para;</a></h3> <ul> <li>Mostly Primitive types, <strong>by default</strong> use copy mecahnism. That means the value of variable is copied to another variable. Both have their own copy and both are independent owners of their own copy and not connected to each other.</li> <li>When variable is assigned to another variable or pass it to the function as parameter then Rust make copy of owner variable's value and assign it to the another variable or function parameter.</li> <li>The ownership state of the original variable binding is set to “copied” state.</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>//# Variable assignment</span>
<span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=c1>// Stack allocated integer</span>
<span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=k>u32</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=c1>// Copy `x` into `y`</span>
<span class=w>  </span><span class=c1>// No resources are moved</span>
<span class=w>  </span><span class=c1>// `x` is still an owner</span>
<span class=w>  </span><span class=c1>// `y` is also a independent owner having same</span>
<span class=w>  </span><span class=c1>// value as `x` that is `5`</span>
<span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=c1>// Both values can be independently used</span>
<span class=w>  </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&quot;x is {}, and y is {}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=c1>// Output: x is 5, and y is 5</span>

<span class=c1>//# Pass variable as function parameter</span>
<span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=c1>// Stack allocated integer</span>
<span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>5</span><span class=k>u32</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=c1>// Copy - pass `x` to function test</span>
<span class=w>  </span><span class=c1>// no resources are moved</span>
<span class=w>  </span><span class=c1>// `x` is still an owner</span>
<span class=w>  </span><span class=n>test</span><span class=p>(</span><span class=n>x</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=c1>// Can access `x` because</span>
<span class=w>  </span><span class=c1>// it is still an owner</span>
<span class=w>  </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&quot;x: {}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=k>fn</span> <span class=nf>test</span><span class=p>(</span><span class=n>y</span>: <span class=kt>u32</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=c1>// `y` is also a owner having same</span>
<span class=w>  </span><span class=c1>// value as x that is `5`</span>
<span class=w>  </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&quot;y: {}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>
<span class=c1>// Output</span>
<span class=c1>// y: 5</span>
<span class=c1>// x: 5</span>
</pre></div> </td></tr></table> <h2 id=move-type>Move type<a class=headerlink href=#move-type title="Permanent link">&para;</a></h2> <blockquote> <p>Memory allocation <strong>[heap]</strong></p> </blockquote> <p>Data with a size that is unknown at compile time or a size that might change must be stored on the heap instead. For example <code>String</code> type.</p> <h3 id=points_1>Points<a class=headerlink href=#points_1 title="Permanent link">&para;</a></h3> <ul> <li>Non-primitive types, <strong>by default</strong> use move mechanism. It does not copy the data from one variable to another, rather it copy the memory address of variable which points to the data in heap to another variable and then unlink or disconnected the previous owner.</li> <li>When variable is assigned to another variable or pass it to the function as parameter then Rust move ownership to the another variable or function parameter and we can not access the original variable binding anymore.</li> <li>The ownership state of the original variable binding is set to “moved” state.</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>//# Variable assignment</span>
<span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=c1>// Heap allocated string</span>
<span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=n>s1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&quot;hello&quot;</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=c1>// Move `s1` into `s2`</span>
<span class=w>  </span><span class=c1>// resources are moved</span>
<span class=w>  </span><span class=c1>// `s1` is not an owner anymore</span>
<span class=w>  </span><span class=c1>// The pointer address of `s1` is copied (not the data) into `s2`.</span>
<span class=w>  </span><span class=c1>// `s2` now pointers to the heap allocated data, and</span>
<span class=w>  </span><span class=c1>// `s2` now an owner. `s1` is disconnected from data.</span>
<span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=n>s2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s1</span><span class=p>;</span><span class=w></span>
<span class=w>  </span><span class=c1>// Error! `s1` can no longer access the data, because it no longer owns it</span>
<span class=w>  </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&quot;{}, world!&quot;</span><span class=p>,</span><span class=w> </span><span class=n>s1</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=c1>//# Pass variable as function parameter</span>
<span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=n>s1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&quot;hello&quot;</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=n>test</span><span class=p>(</span><span class=n>s1</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=c1>// Error! `s1` can no longer access the data</span>
<span class=w>  </span><span class=c1>// `s2` owns it and `s2` is gone out of scope</span>
<span class=w>  </span><span class=c1>// here when `test` execution is ended. Since `s2`</span>
<span class=w>  </span><span class=c1>// was an owner not `s1`, so when `s2` go out of scope</span>
<span class=w>  </span><span class=c1>// memory is freed completely.</span>
<span class=w>  </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&quot;s1: {}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>s1</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=k>fn</span> <span class=nf>test</span><span class=p>(</span><span class=n>s2</span>: <span class=nb>String</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=c1>// `s2` is an owner now</span>
<span class=w>  </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&quot;s2: {}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>s2</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w> </span><span class=c1>// `s2` is destroyed and the memory freed</span>
<span class=w>  </span><span class=c1>// at this point means when function execution</span>
<span class=w>  </span><span class=c1>// is ended after control passes `}`</span>
</pre></div> </td></tr></table> <h2 id=give-and-take-ownership>Give and take ownership<a class=headerlink href=#give-and-take-ownership title="Permanent link">&para;</a></h2> <p>When ownership is moved to another variable then you can give it back by reassigning the variable.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>s1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&quot;hello&quot;</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=c1>// Move ownership to function parameter a</span>
<span class=w>  </span><span class=c1>// get it back by reassigning</span>
<span class=w>  </span><span class=n>s1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>test</span><span class=p>(</span><span class=n>s1</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&quot;s1: {}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>s1</span><span class=p>);</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=k>fn</span> <span class=nf>test</span><span class=p>(</span><span class=n>a</span>: <span class=nb>String</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>String</span> <span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&quot;a: {}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=p>);</span><span class=w></span>
<span class=w>  </span><span class=n>a</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</pre></div> </td></tr></table> <blockquote> <p>Taking ownership and then returning ownership with every function is a bit tedious. <strong>What if we want to let a function use a value but not take ownership?</strong> It’s quite annoying that anything we pass in also needs to be passed back if we want to use it again, in addition to any data resulting from the body of the function that we might want to return as well. Luckily for us, Rust has a feature for this concept, called <strong>references and borrowing</strong>.</p> </blockquote> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Abhay Garg </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.c648116f.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>