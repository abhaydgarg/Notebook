<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Notebook collections"><link href=https://abhaydgarg.github.io/Notebook/index.html/redux/performance-mapStateToProps/ rel=canonical><meta name=author content="Abhay Garg"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.2"><title>Performance of mapStateToProps - Notebook</title><link rel=stylesheet href=../../assets/stylesheets/application.30686662.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#2196f3><script src=../../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700|Ubuntu+Mono&display=fallback"><style>body,input{font-family:"Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr data-md-color-primary=blue data-md-color-accent=blue> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#performance-of-mapstatetoprops tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://abhaydgarg.github.io/Notebook/index.html title=Notebook class="md-header-nav__button md-logo"> <i class=md-icon></i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Notebook </span> <span class=md-header-nav__topic> Performance of mapStateToProps </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/abhaydgarg/Notebook/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://abhaydgarg.github.io/Notebook/index.html title=Notebook class="md-nav__button md-logo"> <i class=md-icon></i> </a> Notebook </label> <div class=md-nav__source> <a href=https://github.com/abhaydgarg/Notebook/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../computer-science/ title=CS class=md-nav__link> CS </a> </li> <li class=md-nav__item> <a href=../../parser/ title=Parser class=md-nav__link> Parser </a> </li> <li class=md-nav__item> <a href=../../data-structure-and-algorithms/ title="Data Structure and Algorithms" class=md-nav__link> Data Structure and Algorithms </a> </li> <li class=md-nav__item> <a href=../../oops/ title=OOPS class=md-nav__link> OOPS </a> </li> <li class=md-nav__item> <a href=../../design-patterns/ title="Design Patterns" class=md-nav__link> Design Patterns </a> </li> <li class=md-nav__item> <a href=../../regex/ title=Regex class=md-nav__link> Regex </a> </li> <li class=md-nav__item> <a href=../../git/ title=GIT class=md-nav__link> GIT </a> </li> <li class=md-nav__item> <a href=../../css/ title=CSS class=md-nav__link> CSS </a> </li> <li class=md-nav__item> <a href=../../rest-api/ title="REST API" class=md-nav__link> REST API </a> </li> <li class=md-nav__item> <a href=../../javascript/ title=Javascript class=md-nav__link> Javascript </a> </li> <li class=md-nav__item> <a href=../../nodejs/ title=Node.js class=md-nav__link> Node.js </a> </li> <li class=md-nav__item> <a href=../../npm/ title=NPM class=md-nav__link> NPM </a> </li> <li class=md-nav__item> <a href=../ title=Redux class=md-nav__link> Redux </a> </li> <li class=md-nav__item> <a href=../../react/ title=React class=md-nav__link> React </a> </li> <li class=md-nav__item> <a href=../../react-native/ title="React Native" class=md-nav__link> React Native </a> </li> <li class=md-nav__item> <a href=../../mongodb/ title=MongoDB class=md-nav__link> MongoDB </a> </li> <li class=md-nav__item> <a href=../../web-security/ title="Web Security" class=md-nav__link> Web Security </a> </li> <li class=md-nav__item> <a href=../../rust/ title=Rust class=md-nav__link> Rust </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#it-should-be-fast class=md-nav__link> It should be fast </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#how-react-redux-ensures-the-performance-of-mapstatetoprops class=md-nav__link> How react-redux ensures the performance of mapStateToProps </a> </li> <li class=md-nav__item> <a href=#developer-duty class=md-nav__link> Developer duty </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/abhaydgarg/Notebook/tree/master/src/redux/performance-mapStateToProps.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1 id=performance-of-mapstatetoprops>Performance of mapStateToProps<a class=headerlink href=#performance-of-mapstatetoprops title="Permanent link">&para;</a></h1> <h2 id=it-should-be-fast>It should be fast<a class=headerlink href=#it-should-be-fast title="Permanent link">&para;</a></h2> <div class="admonition important"> <p class=admonition-title>Why</p> <p>Whenever the store changes, all of the <code>mapStateToProps</code> functions of all of the connected components will run. This is very important to understand. This means, say, if you have 10 comps connected (subscribed) to store by <code>mapStateToProps</code> and store's state get changed. Now react-redux does not know which comp is acually using the property that has changed. So react-redux runs <code>mapStateToProps</code> function of all 10 comps and compare the old and new values of <code>mapStateToProps</code> if it sees the change in any of the value then it re-render the comp or otherwise skip the render. Because of this, your <code>mapStateToProps</code> function should run as fast as possible.</p> </div> <h3 id=how-react-redux-ensures-the-performance-of-mapstatetoprops>How react-redux ensures the performance of mapStateToProps<a class=headerlink href=#how-react-redux-ensures-the-performance-of-mapstatetoprops title="Permanent link">&para;</a></h3> <p><code>connect</code> is a HOC comp, which uses the <code>shouldComponentUpdate</code> method internally and when <code>mapStateToProps</code> function is executted. React Redux decides whether the contents of the object returned from <code>mapStateToProps</code> are different from previous using <code>===</code> comparison (a "shallow equality" check) on each fields of the returned object. If any of the fields have changed, then your component will be re-rendered so it can receive the updated values as props.</p> <blockquote> <p>This way react-redux avoid the reconciliation process <em>(skip running render method, so no need to compare old virtual DOM with new one and mutate the DOM if found any change)</em> which is a huge benefit for performance.</p> </blockquote> <h3 id=developer-duty>Developer duty<a class=headerlink href=#developer-duty title="Permanent link">&para;</a></h3> <blockquote> <p><strong>Note:</strong> Return Value of <code>mapStateToProps</code> determine if component re-renders.</p> </blockquote> <p>React Redux does shallow comparisons to see if the mapStateToProps results have changed. It’s easy to accidentally return new object or array references every time, which would cause your component to re-render even if the data is actually the same.</p> <p>As a developer, you should be careful about the <strong>selector</strong> function which returns new object or an array. In case of primitive types, you need not to worry. But be careful, when returning object or array from selector function. For example,</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>// Selector function</span>
<span class=kd>function</span> <span class=nx>getIncompleteTodos</span><span class=p>(</span><span class=nx>state</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=nx>state</span><span class=p>.</span><span class=nx>todos</span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>todo</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=k>return</span> <span class=o>!</span><span class=nx>todo</span><span class=p>.</span><span class=nx>completed</span>
  <span class=p>});</span>
<span class=p>}</span>

<span class=c1>// In component</span>
<span class=kd>function</span> <span class=nx>mapStateToProps</span><span class=p>(</span><span class=nx>state</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=p>{</span>
    <span class=nx>incompleteTodos</span><span class=o>:</span> <span class=nx>getIncompleteTodos</span><span class=p>(</span><span class=nx>state</span><span class=p>)</span>
  <span class=p>};</span>
<span class=p>}</span>
</pre></div> </td></tr></table> <p><code>incompleteTodos</code> will get new array always because <code>filter</code> function returns a new array. Let's say, state get changed, and react-redux run all <code>mapStateToProps</code> functions. Say the state property that has changed is not subscribed to this particular comp which is <code>todos</code>. But still react-redux sees that <code>incompleteTodos</code> array reference is different from old one. And it re-render the comp which we do not need at all.</p> <div class="admonition question"> <p class=admonition-title>How to avoid re-render in case of new object or array reference</p> <p>Put these operations in memoized selector functions (<strong>reselect</strong> library) to ensure that they only run if the input values have changed. This will also ensure that if the input values haven't changed, mapStateToProps will still return the same result values as before, and connect can skip re-rendering.</p> </div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Abhay Garg </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.c648116f.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>