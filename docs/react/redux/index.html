<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Notebook collections"><link href=https://abhaydgarg.github.io/Notebook/index.html/react/redux/ rel=canonical><meta name=author content="Abhay Garg"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.2"><title>Redux - Notebook</title><link rel=stylesheet href=../../assets/stylesheets/application.30686662.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#2196f3><script src=../../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700|Ubuntu+Mono&display=fallback"><style>body,input{font-family:"Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr data-md-color-primary=blue data-md-color-accent=blue> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#redux tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://abhaydgarg.github.io/Notebook/index.html title=Notebook class="md-header-nav__button md-logo"> <i class=md-icon></i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Notebook </span> <span class=md-header-nav__topic> Redux </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/abhaydgarg/Notebook/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://abhaydgarg.github.io/Notebook/index.html title=Notebook class="md-nav__button md-logo"> <i class=md-icon></i> </a> Notebook </label> <div class=md-nav__source> <a href=https://github.com/abhaydgarg/Notebook/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../computer-science/ title=CS class=md-nav__link> CS </a> </li> <li class=md-nav__item> <a href=../../parser/ title=Parser class=md-nav__link> Parser </a> </li> <li class=md-nav__item> <a href=../../data-structure-and-algorithms/ title="Data Structure and Algorithms" class=md-nav__link> Data Structure and Algorithms </a> </li> <li class=md-nav__item> <a href=../../oops/ title=OOPS class=md-nav__link> OOPS </a> </li> <li class=md-nav__item> <a href=../../design-patterns/ title="Design Patterns" class=md-nav__link> Design Patterns </a> </li> <li class=md-nav__item> <a href=../../regex/ title=Regex class=md-nav__link> Regex </a> </li> <li class=md-nav__item> <a href=../../git/ title=GIT class=md-nav__link> GIT </a> </li> <li class=md-nav__item> <a href=../../css/ title=CSS class=md-nav__link> CSS </a> </li> <li class=md-nav__item> <a href=../../rest-api/ title="REST API" class=md-nav__link> REST API </a> </li> <li class=md-nav__item> <a href=../../eslint/ title=ESLint class=md-nav__link> ESLint </a> </li> <li class=md-nav__item> <a href=../../javascript/ title=Javascript class=md-nav__link> Javascript </a> </li> <li class=md-nav__item> <a href=../../nodejs/ title=Node.js class=md-nav__link> Node.js </a> </li> <li class=md-nav__item> <a href=../ title=React class=md-nav__link> React </a> </li> <li class=md-nav__item> <a href=../../react-native/ title="React Native" class=md-nav__link> React Native </a> </li> <li class=md-nav__item> <a href=../../redux-saga/ title="Redux Saga" class=md-nav__link> Redux Saga </a> </li> <li class=md-nav__item> <a href=../../rxjs/ title=RxJS class=md-nav__link> RxJS </a> </li> <li class=md-nav__item> <a href=../../mysql/ title=MySQL class=md-nav__link> MySQL </a> </li> <li class=md-nav__item> <a href=../../mongodb/ title=MongoDB class=md-nav__link> MongoDB </a> </li> <li class=md-nav__item> <a href=../../web-security/ title="Web Security" class=md-nav__link> Web Security </a> </li> <li class=md-nav__item> <a href=../../rust/ title=Rust class=md-nav__link> Rust </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#action class=md-nav__link> action </a> </li> <li class=md-nav__item> <a href=#reducer class=md-nav__link> reducer </a> </li> <li class=md-nav__item> <a href=#mapstatetoprops class=md-nav__link> mapStateToProps </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#selectors class=md-nav__link> Selectors </a> </li> <li class=md-nav__item> <a href=#performance-of-mapstatetoprops class=md-nav__link> Performance of mapStateToProps </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#it-should-be-fast class=md-nav__link> It should be fast </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#how-react-redux-ensures-the-performance-of-mapstatetoprops class=md-nav__link> How react-redux ensures the performance of mapStateToProps </a> </li> <li class=md-nav__item> <a href=#developer-duty class=md-nav__link> Developer duty </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#mapdispatchtoprops class=md-nav__link> mapDispatchToProps </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#number-of-ways-to-dispatch class=md-nav__link> Number of ways to dispatch </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#default-dispatch-as-a-prop class=md-nav__link> Default: dispatch as a Prop </a> </li> <li class=md-nav__item> <a href=#using-mapdispatchtoprops class=md-nav__link> Using mapDispatchToProps </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-mapdispatchtoprops-as-a-function class=md-nav__link> [1] mapDispatchToProps as a function </a> </li> <li class=md-nav__item> <a href=#2-mapdispatchtoprops-as-a-object class=md-nav__link> [2] mapDispatchToProps as a object </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#why-redux-thunk-or-redux-saga class=md-nav__link> Why redux-thunk or redux-saga </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-inline class=md-nav__link> [1] Inline </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pros class=md-nav__link> Pros </a> </li> <li class=md-nav__item> <a href=#cons class=md-nav__link> Cons </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-extracting-action-creator class=md-nav__link> [2] Extracting action creator </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pros_1 class=md-nav__link> Pros </a> </li> <li class=md-nav__item> <a href=#cons_1 class=md-nav__link> Cons </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#middleware class=md-nav__link> Middleware </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#immutable-update-patterns class=md-nav__link> Immutable update patterns </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#updating-nested-objects class=md-nav__link> Updating nested objects </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common-mistake-1-new-variables-that-point-to-the-same-objects class=md-nav__link> Common mistake #1: New variables that point to the same objects </a> </li> <li class=md-nav__item> <a href=#common-mistake-2-only-making-a-shallow-copy-of-one-level class=md-nav__link> Common mistake #2: Only making a shallow copy of one level </a> </li> <li class=md-nav__item> <a href=#correct-approach-copying-all-levels-of-nested-data class=md-nav__link> Correct approach: Copying all levels of nested data </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#inserting-and-removing-items-in-arrays class=md-nav__link> Inserting and removing items in arrays </a> </li> <li class=md-nav__item> <a href=#updating-an-item-in-an-array class=md-nav__link> Updating an item in an array </a> </li> <li class=md-nav__item> <a href=#immutable-update-utility-libraries class=md-nav__link> Immutable update utility libraries </a> </li> <li class=md-nav__item> <a href=#handling-action-creators-reducers-selectors-efficiently class=md-nav__link> Handling action creators, reducers, selectors efficiently </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/abhaydgarg/Notebook/tree/master/src/react/redux.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1 id=redux>Redux<a class=headerlink href=#redux title="Permanent link">&para;</a></h1> <h2 id=action>action<a class=headerlink href=#action title="Permanent link">&para;</a></h2> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kr>export</span> <span class=kr>const</span> <span class=nx>ADD_NOTE</span> <span class=o>=</span> <span class=s1>&#39;ADD_NOTE&#39;</span><span class=p>;</span>

<span class=kr>export</span> <span class=kd>function</span> <span class=nx>addNote</span><span class=p>(</span><span class=nx>title</span><span class=p>,</span> <span class=nx>content</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nx>ADD_NOTE</span><span class=p>,</span> <span class=nx>title</span><span class=o>:</span> <span class=nx>title</span><span class=p>,</span> <span class=nx>content</span><span class=o>:</span> <span class=nx>content</span> <span class=p>};</span>
<span class=p>}</span>
</pre></div> </td></tr></table> <ul> <li>We are exporting a constant <code>ADD_NOTE</code>, since we’re going to be needing it in several places later on.</li> <li>We are exporting the function <code>addNote</code>. This function is an <strong>action creator</strong>, which means that its job is to only return a plain object.</li> </ul> <h2 id=reducer>reducer<a class=headerlink href=#reducer title="Permanent link">&para;</a></h2> <blockquote> <p>(previousState, action) =&gt; newState</p> </blockquote> <p>It takes two arguments: the previous app state, the action being dispatched and returns the new app state.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>ADD_NOTE</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;./actions&#39;</span><span class=p>;</span>

<span class=kr>const</span> <span class=nx>initialState</span> <span class=o>=</span> <span class=p>{</span>
  <span class=nx>notes</span><span class=o>:</span> <span class=p>[]</span>
<span class=p>};</span>

<span class=kd>function</span> <span class=nx>rootReducer</span><span class=p>(</span><span class=nx>state</span> <span class=o>=</span> <span class=nx>initialState</span><span class=p>,</span> <span class=nx>action</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>switch</span><span class=p>(</span><span class=nx>action</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>case</span> <span class=nx>ADD_NOTE</span><span class=o>:</span>
      <span class=k>return</span> <span class=p>{</span>
        <span class=nx>notes</span><span class=o>:</span> <span class=p>[</span>
          <span class=p>...</span><span class=nx>state</span><span class=p>.</span><span class=nx>notes</span><span class=p>,</span>
          <span class=p>{</span>
            <span class=nx>title</span><span class=o>:</span> <span class=nx>action</span><span class=p>.</span><span class=nx>title</span><span class=p>,</span>
            <span class=nx>content</span><span class=o>:</span> <span class=nx>action</span><span class=p>.</span><span class=nx>content</span>
          <span class=p>}</span>
        <span class=p>]</span>
      <span class=p>};</span>
    <span class=k>default</span><span class=o>:</span>
      <span class=k>return</span> <span class=nx>state</span><span class=p>;</span>
  <span class=p>};</span>
<span class=p>}</span>

<span class=kr>export</span> <span class=k>default</span> <span class=nx>rootReducer</span><span class=p>;</span>
</pre></div> </td></tr></table> <h2 id=mapstatetoprops>mapStateToProps<a class=headerlink href=#mapstatetoprops title="Permanent link">&para;</a></h2> <blockquote> <p>If you provide mapStateToProps then only the component is subscribed to store - re-render when state's object get changed. It listen to state's changes.</p> </blockquote> <table> <thead> <tr> <th>Subscribe</th> <th>Not subscribe</th> </tr> </thead> <tbody> <tr> <td>connect(mapStateToProps)(Component)</td> <td>connect()(Component)</td> </tr> <tr> <td>connect(mapStateToProps, mapDispatchToProps)(Component)</td> <td>connect(null, mapDispatchToProps)(Component)</td> </tr> </tbody> </table> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kr>class</span> <span class=nx>Notes</span> <span class=kr>extends</span> <span class=nx>Component</span> <span class=p>{</span>
  <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>notes</span><span class=p>);</span>
  <span class=p>}</span>
<span class=p>}</span>

<span class=kr>const</span> <span class=nx>mapStateToProps</span> <span class=o>=</span> <span class=nx>state</span> <span class=p>=&gt;</span> <span class=p>{</span>
  <span class=k>return</span> <span class=p>{</span>
    <span class=nx>notes</span><span class=o>:</span> <span class=nx>state</span><span class=p>.</span><span class=nx>notes</span>
  <span class=p>};</span>
<span class=p>};</span>

<span class=kr>export</span> <span class=k>default</span> <span class=nx>connect</span><span class=p>(</span><span class=nx>mapStateToProps</span><span class=p>)(</span><span class=nx>Notes</span><span class=p>);</span>
</pre></div> </td></tr></table> <p><code>mapStateToProps</code> takes an <strong>optional second argument</strong>, which lets you use the component own props that are not from store.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kr>const</span> <span class=nx>mapStateToProps</span> <span class=o>=</span> <span class=p>(</span><span class=nx>state</span><span class=p>,</span> <span class=nx>ownProps</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
  <span class=k>return</span> <span class=p>{</span>
    <span class=nx>notes</span><span class=o>:</span> <span class=nx>state</span><span class=p>.</span><span class=nx>notes</span>
  <span class=p>};</span>
<span class=p>};</span>
</pre></div> </td></tr></table> <h3 id=selectors>Selectors<a class=headerlink href=#selectors title="Permanent link">&para;</a></h3> <p>A selector is simply this: A function that takes the current application state and returns the relevant portion needed by the view.</p> <p>For example:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>// This is what we usually do to get</span>
<span class=c1>// state and map to props. We are doing</span>
<span class=c1>// filter operation on state before mapping</span>
<span class=c1>// to props. This may lead to messy mapStateToProps</span>
<span class=c1>// function.</span>
<span class=kd>function</span> <span class=nx>mapStateToProps</span><span class=p>(</span><span class=nx>state</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=p>{</span>
    <span class=nx>incompleteTodos</span><span class=o>:</span> <span class=nx>state</span><span class=p>.</span><span class=nx>todos</span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>todo</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=k>return</span> <span class=o>!</span><span class=nx>todo</span><span class=p>.</span><span class=nx>completed</span>
    <span class=p>});</span>
  <span class=p>}</span>
<span class=p>}</span>
</pre></div> </td></tr></table> <p>Instead, we can create selector function in reducer file:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5
6</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>// Selector</span>
<span class=kd>function</span> <span class=nx>getIncompleteTodos</span><span class=p>(</span><span class=nx>state</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=nx>state</span><span class=p>.</span><span class=nx>todos</span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>todo</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=k>return</span> <span class=o>!</span><span class=nx>todo</span><span class=p>.</span><span class=nx>completed</span>
  <span class=p>});</span>
<span class=p>}</span>
</pre></div> </td></tr></table> <p>Now, we could use the newly created selector in its place:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kd>function</span> <span class=nx>mapStateToProps</span><span class=p>(</span><span class=nx>state</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=p>{</span>
    <span class=nx>incompleteTodos</span><span class=o>:</span> <span class=nx>getIncompleteTodos</span><span class=p>(</span><span class=nx>state</span><span class=p>)</span>
  <span class=p>};</span>
<span class=p>}</span>
</pre></div> </td></tr></table> <p>The code is more concise and we have made a big step toward encapsulating our state tree. The component no longer cares how todos are stored in the state tree and it will be much easier to refactor if the state tree needs to be updated!</p> <h3 id=performance-of-mapstatetoprops>Performance of mapStateToProps<a class=headerlink href=#performance-of-mapstatetoprops title="Permanent link">&para;</a></h3> <h4 id=it-should-be-fast>It should be fast<a class=headerlink href=#it-should-be-fast title="Permanent link">&para;</a></h4> <div class="admonition important"> <p class=admonition-title>Why</p> <p>Whenever the store changes, all of the <code>mapStateToProps</code> functions of all of the connected components will run. This is very important to understand. This means, say, if you have 10 comps connected (subscribed) to store by <code>mapStateToProps</code> and store's state get changed. Now react-redux does not know which comp is acually using the property that has changed. So react-redux runs <code>mapStateToProps</code> function of all 10 comps and compare the old and new values of <code>mapStateToProps</code> if it sees the change in any of the value then it re-render the comp or otherwise skip the render. Because of this, your <code>mapStateToProps</code> function should run as fast as possible.</p> </div> <h5 id=how-react-redux-ensures-the-performance-of-mapstatetoprops>How react-redux ensures the performance of mapStateToProps<a class=headerlink href=#how-react-redux-ensures-the-performance-of-mapstatetoprops title="Permanent link">&para;</a></h5> <p><code>connect</code> is a HOC comp, which uses the <code>shouldComponentUpdate</code> method internally and when <code>mapStateToProps</code> function is executted. React Redux decides whether the contents of the object returned from <code>mapStateToProps</code> are different from previous using <code>===</code> comparison (a "shallow equality" check) on each fields of the returned object. If any of the fields have changed, then your component will be re-rendered so it can receive the updated values as props.</p> <blockquote> <p>This way react-redux avoid the reconciliation process <em>(skip running render method, so no need to compare old virtual DOM with new one and mutate the DOM if found any change)</em> which is a huge benefit for performance.</p> </blockquote> <h5 id=developer-duty>Developer duty<a class=headerlink href=#developer-duty title="Permanent link">&para;</a></h5> <blockquote> <p><strong>Note:</strong> Return Value of <code>mapStateToProps</code> determine if component re-renders.</p> </blockquote> <p>React Redux does shallow comparisons to see if the mapStateToProps results have changed. It’s easy to accidentally return new object or array references every time, which would cause your component to re-render even if the data is actually the same.</p> <p>As a developer, you should be careful about the <strong>selector</strong> function which returns new object or an array. In case of primitive types, you need not to worry. But be careful, when returning object or array from selector function. For example,</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>// Selector function</span>
<span class=kd>function</span> <span class=nx>getIncompleteTodos</span><span class=p>(</span><span class=nx>state</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=nx>state</span><span class=p>.</span><span class=nx>todos</span><span class=p>.</span><span class=nx>filter</span><span class=p>((</span><span class=nx>todo</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=k>return</span> <span class=o>!</span><span class=nx>todo</span><span class=p>.</span><span class=nx>completed</span>
  <span class=p>});</span>
<span class=p>}</span>

<span class=c1>// In component</span>
<span class=kd>function</span> <span class=nx>mapStateToProps</span><span class=p>(</span><span class=nx>state</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=p>{</span>
    <span class=nx>incompleteTodos</span><span class=o>:</span> <span class=nx>getIncompleteTodos</span><span class=p>(</span><span class=nx>state</span><span class=p>)</span>
  <span class=p>};</span>
<span class=p>}</span>
</pre></div> </td></tr></table> <p><code>incompleteTodos</code> will get new array always because <code>filter</code> function returns a new array. Let's say, state get changed, and react-redux run all <code>mapStateToProps</code> functions. Say the state property that has changed is not subscribed to this particular comp which is <code>todos</code>. But still react-redux sees that <code>incompleteTodos</code> array reference is different from old one. And it re-render the comp which we do not need at all.</p> <div class="admonition question"> <p class=admonition-title>How to avoid re-render in case of new object or array reference</p> <p>Put these operations in memoized selector functions (<strong>reselect</strong> library) to ensure that they only run if the input values have changed. This will also ensure that if the input values haven't changed, mapStateToProps will still return the same result values as before, and connect can skip re-rendering.</p> </div> <h2 id=mapdispatchtoprops>mapDispatchToProps<a class=headerlink href=#mapdispatchtoprops title="Permanent link">&para;</a></h2> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>addNote</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;./actions&#39;</span><span class=p>;</span>

<span class=kr>class</span> <span class=nx>NotesForm</span> <span class=kr>extends</span> <span class=nx>Component</span> <span class=p>{</span>
  <span class=nx>handleSubmission</span> <span class=o>=</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=c1>// dispatch action</span>
    <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>addNote</span><span class=p>(</span><span class=nx>title</span><span class=p>,</span> <span class=nx>content</span><span class=p>);</span>
  <span class=p>}</span>
<span class=p>}</span>

<span class=kr>const</span> <span class=nx>mapDispatchToProps</span> <span class=o>=</span> <span class=p>{</span>
  <span class=nx>addNote</span><span class=o>:</span> <span class=nx>addNote</span>
<span class=p>};</span>

<span class=kr>export</span> <span class=k>default</span> <span class=nx>connect</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=nx>mapDispatchToProps</span><span class=p>)(</span><span class=nx>NotesForm</span><span class=p>);</span>
</pre></div> </td></tr></table> <h3 id=number-of-ways-to-dispatch>Number of ways to dispatch<a class=headerlink href=#number-of-ways-to-dispatch title="Permanent link">&para;</a></h3> <h4 id=default-dispatch-as-a-prop>Default: dispatch as a Prop<a class=headerlink href=#default-dispatch-as-a-prop title="Permanent link">&para;</a></h4> <p>If you don't specify the second argument <code>mapDispatchToProps</code>, your component will receive <code>props.dispatch</code> as prop by default.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>addNote</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;./actions&#39;</span><span class=p>;</span>

<span class=kr>class</span> <span class=nx>NotesForm</span> <span class=kr>extends</span> <span class=nx>Component</span> <span class=p>{</span>

  <span class=nx>handleSubmission</span> <span class=o>=</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=c1>// dispatch action</span>
    <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>dispatch</span><span class=p>(</span><span class=nx>addNote</span><span class=p>(</span><span class=nx>title</span><span class=p>,</span> <span class=nx>content</span><span class=p>));</span>
  <span class=p>}</span>
<span class=p>}</span>

<span class=kr>export</span> <span class=k>default</span> <span class=nx>connect</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=kc>null</span><span class=p>)(</span><span class=nx>NotesForm</span><span class=p>);</span>
</pre></div> </td></tr></table> <h4 id=using-mapdispatchtoprops>Using mapDispatchToProps<a class=headerlink href=#using-mapdispatchtoprops title="Permanent link">&para;</a></h4> <p>If you define your own mapDispatchToProps, the connected component will no longer receive dispatch.</p> <p>It lets you provide action dispatching functions as props. Therefore, instead of calling <code>this.props.dispatch(() =&gt; addNote())</code>, you may call <code>this.props.addNote()</code> directly. Having dispatch function as prop you can <strong>pass it down to child</strong> component as prop. So child comp need not be aware of redux and requir to be connected using <code>connect()</code> and still dispatch an action.</p> <h5 id=1-mapdispatchtoprops-as-a-function>[1] mapDispatchToProps as a function<a class=headerlink href=#1-mapdispatchtoprops-as-a-function title="Permanent link">&para;</a></h5> <p>Allows more customization.</p> <ul> <li>Arguments: <code>dispatch</code> and optional <code>ownProps</code>.</li> <li>Return: plain object where each key will become a prop of a component, and the value should normally be a function that dispatches an action when called.</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>addNote</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;./actions&#39;</span><span class=p>;</span>

<span class=kr>class</span> <span class=nx>NotesForm</span> <span class=kr>extends</span> <span class=nx>Component</span> <span class=p>{</span>

  <span class=nx>handleSubmission</span> <span class=o>=</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=c1>// dispatch action</span>
    <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>addNote</span><span class=p>(</span><span class=nx>title</span><span class=p>,</span> <span class=nx>content</span><span class=p>);</span>
  <span class=p>}</span>
<span class=p>}</span>

<span class=kr>const</span> <span class=nx>mapDispatchToProps</span> <span class=o>=</span> <span class=p>(</span><span class=nx>dispatch</span><span class=p>,</span> <span class=nx>ownProps</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
  <span class=k>return</span> <span class=p>{</span>
    <span class=nx>addNote</span><span class=o>:</span> <span class=p>(</span><span class=nx>title</span><span class=p>,</span> <span class=nx>content</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>dispatch</span><span class=p>(</span><span class=nx>addNote</span><span class=p>(</span><span class=nx>title</span><span class=p>,</span> <span class=nx>content</span><span class=p>))</span>
  <span class=p>};</span>
<span class=p>}</span>

<span class=kr>export</span> <span class=k>default</span> <span class=nx>connect</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=nx>mapDispatchToProps</span><span class=p>)(</span><span class=nx>NotesForm</span><span class=p>);</span>
</pre></div> </td></tr></table> <h5 id=2-mapdispatchtoprops-as-a-object>[2] mapDispatchToProps as a object<a class=headerlink href=#2-mapdispatchtoprops-as-a-object title="Permanent link">&para;</a></h5> <blockquote> <p>We recommend always using the “object shorthand” form of mapDispatchToProps, unless you have a specific reason to customize the dispatching behavior.</p> </blockquote> <p>Setup for dispatching Redux actions in a React component follows a very similar process: define an action creator, wrap it in another function that looks like <code>(…args) =&gt; dispatch(actionCreator(…args))</code>, and pass that wrapper function as a prop to your component.</p> <p>Because this is so common, connect supports an “object shorthand” form for the mapDispatchToProps argument: if you pass an object full of action creators instead of a function, <code>connect</code> will automatically call <code>bindActionCreators</code> for you internally.</p> <p><strong>Note:</strong> Each key of the mapDispatchToProps object is an action creator.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>addNote</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;./actions&#39;</span><span class=p>;</span>

<span class=kr>class</span> <span class=nx>NotesForm</span> <span class=kr>extends</span> <span class=nx>Component</span> <span class=p>{</span>

  <span class=nx>handleSubmission</span> <span class=o>=</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=c1>// dispatch action</span>
    <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>addNote</span><span class=p>(</span><span class=nx>title</span><span class=p>,</span> <span class=nx>content</span><span class=p>);</span>
  <span class=p>}</span>
<span class=p>}</span>

<span class=kr>const</span> <span class=nx>mapDispatchToProps</span> <span class=o>=</span> <span class=p>{</span>
  <span class=nx>addNote</span><span class=o>:</span> <span class=nx>addNote</span>
<span class=p>};</span>

<span class=kr>export</span> <span class=k>default</span> <span class=nx>connect</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=nx>mapDispatchToProps</span><span class=p>)(</span><span class=nx>NotesForm</span><span class=p>);</span>
</pre></div> </td></tr></table> <h2 id=why-redux-thunk-or-redux-saga>Why redux-thunk or redux-saga<a class=headerlink href=#why-redux-thunk-or-redux-saga title="Permanent link">&para;</a></h2> <p>Let's go step by step to see how many ways we can handle action's dispatch.</p> <p>Example: Show and hide notification.</p> <h3 id=1-inline>[1] Inline<a class=headerlink href=#1-inline title="Permanent link">&para;</a></h3> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>//# Some component.</span>
<span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>dispatch</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;SHOW_NOTIFICATION&#39;</span><span class=p>,</span> <span class=nx>text</span><span class=o>:</span> <span class=s1>&#39;You logged in.&#39;</span> <span class=p>})</span>
<span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
  <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>dispatch</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;HIDE_NOTIFICATION&#39;</span> <span class=p>})</span>
<span class=p>},</span> <span class=mi>5000</span><span class=p>)</span>
</pre></div> </td></tr></table> <h4 id=pros>Pros<a class=headerlink href=#pros title="Permanent link">&para;</a></h4> <ul> <li>Simple and straightforward.</li> <li>No middleware required.</li> </ul> <h4 id=cons>Cons<a class=headerlink href=#cons title="Permanent link">&para;</a></h4> <ul> <li>React component contains business logic, bad for reusing. It's not obvious in this example, but imagine we need to fetch data from server asynchronously.</li> <li>It forces you to duplicate this logic anywhere you want to show a notification. You are using structure <code>{ type: 'SHOW_NOTIFICATION', text: 'any message' }</code> all over the place where required.</li> </ul> <h3 id=2-extracting-action-creator>[2] Extracting action creator<a class=headerlink href=#2-extracting-action-creator title="Permanent link">&para;</a></h3> <p>Extract a function that centralizes the timeout logic and dispatches those two actions.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>//# actions.js</span>
<span class=kd>function</span> <span class=nx>showNotification</span><span class=p>(</span><span class=nx>text</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;SHOW_NOTIFICATION&#39;</span><span class=p>,</span> <span class=nx>text</span> <span class=p>}</span>
<span class=p>}</span>
<span class=kd>function</span> <span class=nx>hideNotification</span><span class=p>()</span> <span class=p>{</span>
  <span class=k>return</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;HIDE_NOTIFICATION&#39;</span> <span class=p>}</span>
<span class=p>}</span>

<span class=kr>export</span> <span class=kd>function</span> <span class=nx>showNotificationWithTimeout</span><span class=p>(</span><span class=nx>dispatch</span><span class=p>)</span> <span class=p>{</span>
  <span class=nx>dispatch</span><span class=p>(</span><span class=nx>showNotification</span><span class=p>(</span><span class=nx>text</span><span class=p>))</span>
  <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=nx>dispatch</span><span class=p>(</span><span class=nx>hideNotification</span><span class=p>())</span>
  <span class=p>},</span> <span class=mi>5000</span><span class=p>)</span>
<span class=p>}</span>
</pre></div> </td></tr></table> <p>Now components can use <code>showNotificationWithTimeout</code> without duplicating this logic.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>//# component.js</span>
<span class=nx>showNotificationWithTimeout</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>dispatch</span><span class=p>,</span> <span class=s1>&#39;You just logged in.&#39;</span><span class=p>)</span>

<span class=c1>//# otherComponent.js</span>
<span class=nx>showNotificationWithTimeout</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>dispatch</span><span class=p>,</span> <span class=s1>&#39;You just logged out.&#39;</span><span class=p>)</span>
</pre></div> </td></tr></table> <p>Why does <code>showNotificationWithTimeout()</code> accept <code>dispatch</code> as the first argument? Because it needs to dispatch actions to the store. Normally a component has access to <code>dispatch</code> but since we want an external function to take control over dispatching, we need to give it control over dispatching.</p> <h4 id=pros_1>Pros<a class=headerlink href=#pros_1 title="Permanent link">&para;</a></h4> <ul> <li>Logic is centralized, no more duplication.</li> <li>Component doesn't need to know business logic. You can fetch data from API in function <code>showNotificationWithTimeout()</code> in a <code>action.js</code> file.</li> </ul> <h4 id=cons_1>Cons<a class=headerlink href=#cons_1 title="Permanent link">&para;</a></h4> <ul> <li>We have to pass <code>dispatch</code> around which makes it trickier to separate container and presentational components.</li> <li>You can’t just bind action creators with <code>connect()</code> anymore because <code>showNotificationWithTimeout()</code> is not really an action creator. It does not return a Redux action's object.</li> </ul> <h3 id=middleware>Middleware<a class=headerlink href=#middleware title="Permanent link">&para;</a></h3> <p>For simple apps, the approach mentioned above should suffice. Don’t worry about middleware if you’re happy with it. In larger apps, however, you might find certain inconveniences around it.</p> <p>For example using redux-thunk as middleware. We “taught” Redux to recognize such “special” action creators (we call them thunk action creators), we can now use them in any place where we would use regular action creators. For example, we can use them with <code>connect()</code>. Earlier we have to have object as paramter for <code>dispatch</code> function in the form <code>{type: 'SHOW_NOTIFICATION', text: 'message'}</code> but now with thunk middleware we can pass function to <code>dispatch</code> which further handle the dispatching of action.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>//# actions.js</span>
<span class=kd>function</span> <span class=nx>showNotification</span><span class=p>(</span><span class=nx>text</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;SHOW_NOTIFICATION&#39;</span><span class=p>,</span> <span class=nx>text</span> <span class=p>}</span>
<span class=p>}</span>
<span class=kd>function</span> <span class=nx>hideNotification</span><span class=p>()</span> <span class=p>{</span>
  <span class=k>return</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;HIDE_NOTIFICATION&#39;</span> <span class=p>}</span>
<span class=p>}</span>

<span class=kr>export</span> <span class=kd>function</span> <span class=nx>showNotificationWithTimeout</span><span class=p>(</span><span class=nx>text</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>dispatch</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>dispatch</span><span class=p>(</span><span class=nx>showNotification</span><span class=p>(</span><span class=nx>text</span><span class=p>))</span>

    <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
      <span class=nx>dispatch</span><span class=p>(</span><span class=nx>hideNotification</span><span class=p>())</span>
    <span class=p>},</span> <span class=mi>5000</span><span class=p>)</span>
  <span class=p>}</span>
<span class=p>}</span>
</pre></div> </td></tr></table> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=c1>//# Some component</span>
<span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>showNotificationWithTimeout</span><span class=p>(</span><span class=s1>&#39;You just logged in.&#39;</span><span class=p>)</span>

<span class=kr>export</span> <span class=k>default</span> <span class=nx>connect</span><span class=p>(</span><span class=nx>mapStateToProps</span><span class=p>,</span> <span class=p>{</span><span class=nx>showNotificationWithTimeout</span><span class=p>})(</span><span class=nx>MyComponent</span><span class=p>)</span>
</pre></div> </td></tr></table> <h2 id=immutable-update-patterns>Immutable update patterns<a class=headerlink href=#immutable-update-patterns title="Permanent link">&para;</a></h2> <h3 id=updating-nested-objects>Updating nested objects<a class=headerlink href=#updating-nested-objects title="Permanent link">&para;</a></h3> <p>The key to updating nested data is that every level of nesting must be copied and updated appropriately.</p> <h4 id=common-mistake-1-new-variables-that-point-to-the-same-objects>Common mistake #1: New variables that point to the same objects<a class=headerlink href=#common-mistake-1-new-variables-that-point-to-the-same-objects title="Permanent link">&para;</a></h4> <p>Defining a new variable does not create a new actual object - it only creates another reference to the same object. This function does correctly return a shallow copy of the top-level state object, but because the <code>nestedState</code> variable was still pointing at the existing object, the state was directly mutated.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kd>function</span> <span class=nx>updateNestedState</span><span class=p>(</span><span class=nx>state</span><span class=p>,</span> <span class=nx>action</span><span class=p>)</span> <span class=p>{</span>
  <span class=kd>let</span> <span class=nx>nestedState</span> <span class=o>=</span> <span class=nx>state</span><span class=p>.</span><span class=nx>nestedState</span>
  <span class=c1>// ERROR: this directly modifies the existing</span>
  <span class=c1>// object reference - don&#39;t do this!</span>
  <span class=nx>nestedState</span><span class=p>.</span><span class=nx>nestedField</span> <span class=o>=</span> <span class=nx>action</span><span class=p>.</span><span class=nx>data</span>

  <span class=k>return</span> <span class=p>{</span>
    <span class=p>...</span><span class=nx>state</span><span class=p>,</span>
    <span class=nx>nestedState</span>
  <span class=p>}</span>
<span class=p>}</span>
</pre></div> </td></tr></table> <h4 id=common-mistake-2-only-making-a-shallow-copy-of-one-level>Common mistake #2: Only making a shallow copy of one level<a class=headerlink href=#common-mistake-2-only-making-a-shallow-copy-of-one-level title="Permanent link">&para;</a></h4> <p>Doing a shallow copy of the top level is <em>not</em> sufficient - the <code>nestedState</code> object should be copied as well.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kd>function</span> <span class=nx>updateNestedState</span><span class=p>(</span><span class=nx>state</span><span class=p>,</span> <span class=nx>action</span><span class=p>)</span> <span class=p>{</span>
  <span class=c1>// Problem: this only does a shallow copy!</span>
  <span class=kd>let</span> <span class=nx>newState</span> <span class=o>=</span> <span class=p>{</span> <span class=p>...</span><span class=nx>state</span> <span class=p>}</span>

  <span class=c1>// ERROR: nestedState is still the same object!</span>
  <span class=nx>newState</span><span class=p>.</span><span class=nx>nestedState</span><span class=p>.</span><span class=nx>nestedField</span> <span class=o>=</span> <span class=nx>action</span><span class=p>.</span><span class=nx>data</span>

  <span class=k>return</span> <span class=nx>newState</span>
<span class=p>}</span>
</pre></div> </td></tr></table> <h4 id=correct-approach-copying-all-levels-of-nested-data>Correct approach: Copying all levels of nested data<a class=headerlink href=#correct-approach-copying-all-levels-of-nested-data title="Permanent link">&para;</a></h4> <p>Obviously, each layer of nesting makes this harder to read, and gives more chances to make mistakes.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kd>function</span> <span class=nx>updateVeryNestedField</span><span class=p>(</span><span class=nx>state</span><span class=p>,</span> <span class=nx>action</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=p>{</span>
    <span class=p>...</span><span class=nx>state</span><span class=p>,</span>
    <span class=nx>first</span><span class=o>:</span> <span class=p>{</span>
      <span class=p>...</span><span class=nx>state</span><span class=p>.</span><span class=nx>first</span><span class=p>,</span>
      <span class=nx>second</span><span class=o>:</span> <span class=p>{</span>
        <span class=p>...</span><span class=nx>state</span><span class=p>.</span><span class=nx>first</span><span class=p>.</span><span class=nx>second</span><span class=p>,</span>
        <span class=p>[</span><span class=nx>action</span><span class=p>.</span><span class=nx>someId</span><span class=p>]</span><span class=o>:</span> <span class=p>{</span>
          <span class=p>...</span><span class=nx>state</span><span class=p>.</span><span class=nx>first</span><span class=p>.</span><span class=nx>second</span><span class=p>[</span><span class=nx>action</span><span class=p>.</span><span class=nx>someId</span><span class=p>],</span>
          <span class=nx>fourth</span><span class=o>:</span> <span class=nx>action</span><span class=p>.</span><span class=nx>someValue</span>
        <span class=p>}</span>
      <span class=p>}</span>
    <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}</span>
</pre></div> </td></tr></table> <h3 id=inserting-and-removing-items-in-arrays>Inserting and removing items in arrays<a class=headerlink href=#inserting-and-removing-items-in-arrays title="Permanent link">&para;</a></h3> <p>Normally, a Javascript array's contents are modified using mutative functions like <code>push</code>, <code>unshift</code>, and <code>splice</code>. Since we don't want to mutate state directly in reducers, those should normally be avoided. Because of that, you might see "insert" or "remove" behavior written like this:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kd>function</span> <span class=nx>insertItem</span><span class=p>(</span><span class=nx>array</span><span class=p>,</span> <span class=nx>action</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=p>[</span>
    <span class=p>...</span><span class=nx>array</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nx>action</span><span class=p>.</span><span class=nx>index</span><span class=p>),</span>
    <span class=nx>action</span><span class=p>.</span><span class=nx>item</span><span class=p>,</span>
    <span class=p>...</span><span class=nx>array</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=nx>action</span><span class=p>.</span><span class=nx>index</span><span class=p>)</span>
  <span class=p>]</span>
<span class=p>}</span>

<span class=kd>function</span> <span class=nx>removeItem</span><span class=p>(</span><span class=nx>array</span><span class=p>,</span> <span class=nx>action</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=p>[...</span><span class=nx>array</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nx>action</span><span class=p>.</span><span class=nx>index</span><span class=p>),</span> <span class=p>...</span><span class=nx>array</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=nx>action</span><span class=p>.</span><span class=nx>index</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)]</span>
<span class=p>}</span>
</pre></div> </td></tr></table> <h3 id=updating-an-item-in-an-array>Updating an item in an array<a class=headerlink href=#updating-an-item-in-an-array title="Permanent link">&para;</a></h3> <p>Updating one item in an array can be accomplished by using <code>Array.map</code>, returning a new value for the item we want to update, and returning the existing values for all other items:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kd>function</span> <span class=nx>updateObjectInArray</span><span class=p>(</span><span class=nx>array</span><span class=p>,</span> <span class=nx>action</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>return</span> <span class=nx>array</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>item</span><span class=p>,</span> <span class=nx>index</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>index</span> <span class=o>!==</span> <span class=nx>action</span><span class=p>.</span><span class=nx>index</span><span class=p>)</span> <span class=p>{</span>
      <span class=c1>// This isn&#39;t the item we care about - keep it as-is</span>
      <span class=k>return</span> <span class=nx>item</span>
    <span class=p>}</span>

    <span class=c1>// Otherwise, this is the one we want - return an updated value</span>
    <span class=k>return</span> <span class=p>{</span>
      <span class=p>...</span><span class=nx>item</span><span class=p>,</span>
      <span class=p>...</span><span class=nx>action</span><span class=p>.</span><span class=nx>item</span>
    <span class=p>}</span>
  <span class=p>})</span>
<span class=p>}</span>
</pre></div> </td></tr></table> <h3 id=immutable-update-utility-libraries>Immutable update utility libraries<a class=headerlink href=#immutable-update-utility-libraries title="Permanent link">&para;</a></h3> <ul> <li>Immutable.js</li> <li>seamless-immutable</li> <li>immer</li> </ul> <h3 id=handling-action-creators-reducers-selectors-efficiently>Handling action creators, reducers, selectors efficiently<a class=headerlink href=#handling-action-creators-reducers-selectors-efficiently title="Permanent link">&para;</a></h3> <div class="admonition info"> <p class=admonition-title>Reduxsauce</p> <p>This is the library that you should use for creating highly readable redux code, and much easier to maintain redux code in your app.</p> </div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Abhay Garg </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.c648116f.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>